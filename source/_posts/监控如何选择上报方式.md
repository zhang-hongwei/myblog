---
title: 前端监控如何选择上报方式
date: 2019-06-11 21:00:00
tags: 前端监控
---

## 如何选择上报方式
- 如果发送数据量较小，比如采集用户在 Web 页面的页面浏览、元素点击、视区停留等行为事件，采用 image 方式上报给服务端更合适；
- 如果发送数据量较大，比如获取后端所有数据用于前端渲染，ajax 方式更合适；
- 如果需要进行精确统计，比如点击支付按钮、视频播放时长、页面跳转或关闭等行为时，选择 beacon 方式能最大程度保证数据成功率。

## 上报方式对比

上面我们分别对三种数据上报方式进行了介绍，下面从多个角度来分析 image、ajax、sendBeacon 的优缺点，如表 5-1 所示：

| 方式 | https 下使用 http 请求 | 跨域 | 关闭页面发数据 | window.onload 问题 | 请求方式 | 浏览器兼容性 | cookie 携带 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| image | 部分支持 | 完全支持 | 效果差 | 部分支持 | 仅 get | 完全支持 | 同域名携带 |
| ajax | 不支持 | 部分支持 | 效果很差 | 支持 | 多 | 基本支持 | 可配置 |
| sendBeacon | 不支持 | 支持 | 效果好 | 支持 | 仅 post | 部分支持 | 同域名携带 |

通过前面的介绍可以看出，没有一种数据上报方式在各个方面都是优秀的，都有一定的优缺点。因此，面对不同的需求时，我们要选择不同的方式来上报数据：

- 如果发送数据量较小，比如采集用户在 Web 页面的页面浏览、元素点击、视区停留等行为事件，采用 image 方式上报给服务端更合适；
- 如果发送数据量较大，比如获取后端所有数据用于前端渲染，ajax 方式更合适；
- 如果需要进行精确统计，比如点击支付按钮、视频播放时长、页面跳转或关闭等行为时，选择 beacon 方式能最大程度保证数据成功率。

对于神策数据 Web JS SDK 而言，我们为了最大程度上保证数据的可靠性，优先使用 beacon 方式来上报数据。在浏览器不支持 beacon 的情况下，Web JS SDK 自动转而使用 image 方式来上报。